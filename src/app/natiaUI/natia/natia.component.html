<div class="container-fluid py-4 pt-1 p-4 ps-5 pb-3 pe-5">

  <!-- üéÑ New Year / Christmas Animation -->
  <div *ngIf="newYearActive" class="snow-container">
    <div class="snowflake" *ngFor="let flake of snowflakes; trackBy: trackBySnowflake" [style.left.px]="flake.x"
      [style.top.px]="flake.y" [style.width.px]="flake.size" [style.height.px]="flake.size"></div>
  </div>


  <!-- live video background-->
  <!-- DAY video -->
  <video class="bg-video day-video" autoplay muted loop playsinline>
    <source src="assets/video/day-snow.mp4" type="video/mp4" />
  </video>

  <!-- NIGHT video -->
  <video class="bg-video night-video" autoplay muted loop playsinline>
    <source src="assets/video/dark-forest-winter.mp4" type="video/mp4" />
  </video>



  <!-- üå°Ô∏è Temperature Info -->
  <div *ngIf="temperatureInfo" class="temperature-info-container mt-4 container-fluid">

    <div class="d-flex justify-content-between align-items-center flex-wrap">

      <a href="/system-streams" target="_blank">
        <!-- ‚è∞ Watch (left side) -->
        <div class="classic-watch shadow-sm rounded-3 px-3 py-1">
          ‚è∞{{ currentTime | date:'HH:mm:ss' }}
        </div>
      </a>




      <!-- üå°Ô∏è Temperature + Humidity (right side) -->
      <div class="d-flex justify-content-center gap-3 flex-wrap">

        <i class="fa-solid fa-bell fa-shake bell-temp-icon" *ngIf="isHot" style="color: #deeb1e;"></i>

        <span class="badge text-light fs-5" [ngClass]="{
              'natia-temp-error pulse': isHot,
              'temp': !isHot
            }" title="Temperature status">
          <i *ngIf="isHot" class="fa-solid fa-temperature-high fa-bounce" style="color: #ffffff;"></i>
          <i *ngIf="!isHot" class="fa-solid fa-temperature-low" style="color: #24f5dc;"></i>
          {{ temperatureInfo.temperature }} ¬∞C
        </span>

        <span class="badge humidity text-light fs-5" title="Humidity level">
          <i class="fa-solid fa-water fa-fade" style="color: #00aaff;"></i>
          {{ temperatureInfo.humidity }} %
        </span>

      </div>
    </div>
  </div>

  <!-- christmas-tree -->
  <img class="christmas-tree" src="assets/gif/kstr-kochstrasse.gif" alt="christmas-tree">



  <!-- Temperature loading placeholder -->
  <div *ngIf="!temperatureInfo" class="text-center text-light mt-5">
    <img class="loader" src="assets/svg/loader.svg" alt="Loading...">
    ‚è≥ Loading temperature info...
  </div>

  <!-- üì∫ Channel List -->
  <div class="text-center">
    <div *ngIf="channels.length === 0" class="text-center text-light mt-5">
      <img class="loader" src="assets/svg/loader.svg" alt="Loading...">
      ‚è≥ Loading channels...
    </div>

    <div *ngIf="channels.length > 0" class="container-fluid">

      <div class="row chanells-container">
        <hr class="border-light line" />

        <div class="col p-0 " *ngFor="let ch of channels; trackBy: trackByOrder">
          <div class="badge text-center channel-pill" [ngClass]="{
            'natia-error pulse-error': ch.HaveError,
            'natia-test text-light opacity-50': ch.IsDIsable && !ch.HaveError,
            'natia-success': !ch.IsDIsable && !ch.HaveError
          }"
            title="{{ ch.HaveError ? 'Channel has an error' : ch.IsDIsable ? 'Channel is disabled' : 'Channel is active' }}">
            <span class="channel-name float-start fw-bolder">
              <span class="channel-number"> {{ ch.Order }} <i class="fa-solid fa-minus"></i></span> {{ ch.ChanellName }}
            </span>
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- Duck -->
  <div class="duck-container" *ngIf="currentAnimations === 'duck'">
    <img src="assets/gif/santa-claus-runing.gif" class="duck" alt="Duck" />
  </div>

  <!-- Bat -->
  <div class="bat-container" *ngIf="currentAnimations === 'bat'">
    <img src="assets/gif/tree-christmas-tree.gif" class="bat" alt="Bat" />
  </div>

  <!-- Squad -->
  <div class="squad-container" *ngIf="currentAnimations === 'squad'">
    <img src="assets/gif/merry-christmas-pengu.gif" class="squad" alt="Squad Team" />
  </div>

  <!-- Disco container -->
  <div class="disco-container" *ngIf="currentMessage">
    <img *ngIf="currentAnimation" [src]="currentAnimation" alt="Disco Animation" />
    <p *ngIf="currentMessage">{{ currentMessage.message }}</p>
  </div>


  <!-- robot say -->
  <div *ngIf="robotSpeech" class="text-center mt-4 robot-container">
    <i class="fa-solid fa-message fa-bounce bell-icon"></i>
    <h5 class="p-3 rounded-3 d-inline-block">
      <img class="robot-img" src="assets/gif/sports-sportsmanias.gif" alt="happy-robot" width="100" height="100">
      {{ robotSpeech }}
    </h5>
  </div>



  <div class="region-relay-section">
    <!-- Empty state -->
    <div *ngIf="regionRelays.length === 0" class="text-white-50 small">
      <img class="loader" src="assets/svg/loader.svg">
      No region relays available.
    </div>

    <!-- List of regions -->
    <div class="row g-1">
      <div class="col-4 m-0 p-0 " *ngFor="let region of regionRelays; trackBy: trackByRegion">
        <div class="card relay-background text-white shadow-sm compact-card region-relay m-0 p-0">
          <div class="fit-cell">
            <h6 class="card-title  m-0">{{ region.regionName }}</h6>

            <!-- RelayInfos badges -->
            <div *ngFor="let info of region.relayInfos; trackBy: trackByRelayInfo" class="regionrelay-mer">
              <span class="tiny-badge">{{ info.frequecyOrder }}</span>

              <span class="tiny-badge" [ngClass]="{
                    'natia-temp-error': info.isHaveProblem,
                    'natia-warn': !info.isHaveProblem && info.isWarning,
                    'natia-success': !info.isHaveProblem && !info.isWarning
                             }">
                {{ info.mer }}
              </span>

            </div>
          </div>
        </div>
      </div>
    </div>
  </div>



  <!-- emr region temperature -->
  <div class="emr-temperature-section">
    <div *ngIf="emrtemperature.length === 0" class="text-white-50 small text-center">
      <img class="loader" src="assets/svg/loader.svg">
      No region EMR temperature available.
    </div>

    <div class="row emr-temp-row" *ngIf="emrtemperature.length > 0">
      <div class="emr-temp-size" *ngFor="let r of emrtemperature; trackBy: trackByEmrTemperature">
        <div class="emr-temp-background text-white text-center p-1">
          <div class="fw-bold text-truncate">{{ r.Name }}</div>
          <div class="badge emr-temp mt-1 rounded-0">
            {{ r.Temperature }}</div>
          <div class="badge mt-1 rounded-0" [ngClass]="{
           'natia-temp-error': r.IsError,
           'natia-warn': !r.IsError && r.IsWarm,
           'natia-success': !r.IsError && !r.IsWarm
         }">
            {{ r.IsError ? 'Hot' : (r.IsWarm ? 'Warm' : 'Normal') }}
          </div>

        </div>
      </div>
    </div>
  </div>

  <div class="d-block container-fluid pe-5 problem-container">

    <!-- Channels With Problems -->
    <ng-container *ngIf="opticChannels$ | async as channels">
      <!-- Loader / Empty state
      <div *ngIf="channels.length === 0" class="text-white-50 small text-center">
        <img class="loader" src="assets/svg/loader.svg" alt="Loading...">
        No Channels With Problems available.
      </div> -->

      <div class=" float-end" *ngIf="channels.length > 0">
        <div class="table-responsive">
          <h6 class="text-light fw-bold m-0 fs-6 mb-2 channel-problem-title">
            Optic Channels With Problems
          </h6>
          <table class="table table-sm align-middle mb-0 transparent-table">
            <thead class="text-uppercase">
              <tr>
                <th scope="col" class="fit-cell">Channel</th>
                <th scope="col" class="fit-cell">Port</th>
                <th scope="col" class="fit-cell">EMR</th>
                <th scope="col" class="fit-cell">Type</th>
                <th scope="col" class="fit-cell">Status</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let channel of channels">
                <td class="text-capitalize fit-cell transparent-table problem-value">
                  {{ channel?.chanellName }}
                </td>
                <td class="fit-cell transparent-table problem-value">
                  {{ channel?.portInReciever }}
                </td>
                <td class="fit-cell transparent-table problem-value">
                  {{ channel?.emrName }}
                </td>
                <td class="text-capitalize fit-cell transparent-table problem-value">
                  {{ channel?.chanellType }}
                </td>
                <td class="fit-cell transparent-table problem-value">
                  <span class="badge px-2 py-1 status-cell rounded-0" [ngClass]="{
                  'natia-warn text-dark bg-opacity-75': channel.status === 'low bittrate',
                  'natia-temp-error bg-opacity-75': channel.status !== 'low bittrate'
                }">
                    {{ channel?.status | titlecase }}
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </ng-container>

    <!-- CardInfoToActivate -->
    <div class="cards-container float-end" *ngIf="(cards$ | async)?.length">
      <h4 class="text-light fw-bold m-0 fs-6 mb-2">Cards To Activate</h4>
      <table class="cards-table">
        <thead>
          <tr>
            <th>EMR</th>
            <th>Card</th>
            <th>Port</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let card of cards$ | async">
            <td>{{ card?.emr }}</td>
            <td>{{ card?.card }}</td>
            <td>{{ card?.port }}</td>
            <td class="status">{{ card?.status }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>


  <hr class="border-light underline line" />

  <!-- üì° Satellite Overview -->
  <div class="text-center container-fluid satellite-container">
    <div *ngIf="satellites.length === 0" class="text-center text-light mt-5">
      <img class="loader" src="assets/svg/loader.svg" alt="Loading...">
      ‚è≥ Loading satellites...
    </div>

    <div *ngIf="satellites.length > 0" class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4 ps-3">
      <div class="col satellite-box p-0" *ngFor="let sat of satellites; trackBy: trackByDegree">
        <div class="card satellite-card rounded-0 h-100 p-0 text-white border-0 position-relative overflow-hidden">
          <div class="card-header rounded-0 p-0 text-center fs-5 fw-bold" title="Satellite orbital position">
            <span
              *ngIf="sat.Degree && !['Relay','Optic','ENCODERS','MULTISWITCHES','MUKHIANII','MUKHIANI I','MUKHIANI II'].includes(sat.Degree.toString())"
              class="glow-icon">
              üõ∞Ô∏è
            </span>
            {{ sat.Degree }}
          </div>

          <div class="card-body d-flex flex-column p-0">
            <div *ngFor="let d of sat.details" class="sat-detail d-flex p-1">
              <!-- SymbolRate -->
              <span class="badge satellite-value rounded-0" [class.natia-error]="d.HaveError"
                [class.natia-warn]="!d.HaveError && d.HaveWarn" [class.natia-success]="!d.HaveError && !d.HaveWarn"
                [title]="d.HaveError 
                ? 'Transponder has an error' 
                : d.HaveWarn 
                  ? 'Transponder warning' 
                  : 'Operational'">
                {{ d.SymbolRate }}
              </span>
              <!-- MER -->
              <span class="badge rounded-0" *ngIf="d.mer !== 'N/A' && d.mer !== null" [class.error]="d.HaveError"
                [class.natia-warn]="!d.HaveError && d.HaveWarn" [class.symbolRate]="!d.HaveError && !d.HaveWarn">
                {{ d.mer }}
              </span>
            </div>

            <div *ngIf="sat.details.length === 0" class="text-center text-light p-2">
              No transponder details available
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>

</div>